<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Equity Market Companies</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --glass-bg: rgba(255, 255, 255, 0.15);
        --glass-border: rgba(255, 255, 255, 0.2);
        --shadow-light: 0 8px 32px rgba(0, 0, 0, 0.1);
        --shadow-heavy: 0 12px 40px rgba(0, 0, 0, 0.15);
        --text-primary: #1a202c;
        --text-secondary: #4a5568;
        --accent-color: #667eea;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        margin: 0;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        background-attachment: fixed;
        min-height: 100vh;
        color: var(--text-primary);
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .search-box {
        padding: 30px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 20px;
        box-shadow: var(--shadow-light);
        margin-bottom: 30px;
        animation: slideInDown 0.6s ease-out;
      }

      @keyframes slideInDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      input {
        width: 70%;
        padding: 15px 20px;
        font-size: 16px;
        border: none;
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        margin-right: 15px;
        transition: all 0.3s ease;
        outline: none;
      }

      input:focus {
        transform: translateY(-2px);
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1), 0 5px 20px rgba(102, 126, 234, 0.3);
      }

      button {
        padding: 15px 30px;
        background: var(--primary-gradient);
        color: white;
        border: none;
        border-radius: 15px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: var(--shadow-light);
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-heavy);
      }

      .stock-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        box-shadow: var(--shadow-light);
        border-radius: 20px;
        overflow: hidden;
        animation: fadeInUp 0.8s ease-out;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .stock-table th {
        background: var(--primary-gradient);
        color: white;
        padding: 20px;
        text-align: left;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .stock-table td {
        padding: 18px 20px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
      }

      .stock-table tr:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: scale(1.01);
      }

      .positive {
        color: #48bb78;
        font-weight: 600;
      }

      .negative {
        color: #f56565;
        font-weight: 600;
      }

      .time {
        color: var(--text-secondary);
        font-size: 0.9em;
      }

      #loading,
      #error {
        text-align: center;
        padding: 40px;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        margin: 20px 0;
      }

      /* FANTABULOUS JSON VIEWER STYLES */
      .json-viewer {
        background: var(--glass-bg);
        backdrop-filter: blur(25px);
        border: 1px solid var(--glass-border);
        border-radius: 25px;
        padding: 30px;
        margin: 30px 20px;
        box-shadow: var(--shadow-heavy);
        overflow: hidden;
        position: relative;
        animation: jsonFadeIn 1s ease-out;
      }

      @keyframes jsonFadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .json-viewer::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: conic-gradient(from 0deg, transparent, rgba(102, 126, 234, 0.1), transparent);
        animation: rotate 10s linear infinite;
        pointer-events: none;
        z-index: -1;
      }

      @keyframes rotate {
        100% {
          transform: rotate(360deg);
        }
      }

      #searchInput2 {
        margin: 30px auto;
        padding: 15px 25px;
        width: 350px;
        display: block;
        border: none;
        border-radius: 25px;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        font-size: 16px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        outline: none;
      }

      #searchInput2:focus {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 15px 35px rgba(102, 126, 234, 0.3);
        background: rgba(255, 255, 255, 1);
      }

      .key {
        font-weight: 600;
        cursor: pointer;
        color: var(--accent-color);
        transition: all 0.3s ease;
        position: relative;
        display: inline-block;
      }

      .key:hover {
        color: #f093fb;
        transform: translateX(5px);
      }

      .key::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--secondary-gradient);
        transition: width 0.3s ease;
      }

      .key:hover::after {
        width: 100%;
      }

      .nested {
        margin-left: 25px;
        display: none;
        border-left: 3px solid transparent;
        border-image: var(--primary-gradient) 1;
        padding-left: 20px;
        position: relative;
        transition: all 0.4s ease;
      }

      .nested.open {
        display: block;
        animation: expandDown 0.4s ease-out;
      }

      @keyframes expandDown {
        from {
          opacity: 0;
          max-height: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          max-height: 1000px;
          transform: translateX(0);
        }
      }

      .toggle-container {
        cursor: pointer;
        font-weight: 600;
        display: block;
        padding: 12px 20px;
        margin: 8px 0;
        border-radius: 15px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .toggle-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
        transition: left 0.6s ease;
      }

      .toggle-container:hover::before {
        left: 100%;
      }

      .toggle-container:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: rgba(102, 126, 234, 0.3);
      }

      .toggle::before {
        content: '▶';
        display: inline-block;
        margin-right: 10px;
        transition: transform 0.3s ease;
        color: var(--accent-color);
        font-size: 0.8em;
      }

      .nested.open + .toggle-container .toggle::before,
      .toggle-container:has(+ .nested.open) .toggle::before {
        transform: rotate(90deg);
      }

      .key-value {
        margin: 10px 0;
        padding: 10px 15px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        border-left: 4px solid transparent;
        border-image: var(--success-gradient) 1;
        transition: all 0.3s ease;
      }

      .key-value:hover {
        background: rgba(255, 255, 255, 0.08);
        transform: translateX(5px);
      }

      ul {
        padding-left: 0;
        list-style-type: none;
      }

      li {
        display: block;
        margin: 5px 0;
        transition: all 0.3s ease;
      }

      .leaf-value {
        font-weight: 400;
        color: var(--text-secondary);
        background: rgba(255, 255, 255, 0.1);
        padding: 6px 12px;
        border-radius: 8px;
        display: inline-block;
        margin-left: 10px;
        transition: all 0.3s ease;
      }

      .leaf-value:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: scale(1.05);
      }

      /* Links styling */
      a {
        color: var(--accent-color);
        text-decoration: none;
        position: relative;
        transition: all 0.3s ease;
      }

      a:hover {
        color: #f093fb;
      }

      a::after {
        content: '';
        position: absolute;
        bottom: -2px;
        left: 0;
        width: 0;
        height: 2px;
        background: var(--secondary-gradient);
        transition: width 0.3s ease;
      }

      a:hover::after {
        width: 100%;
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--primary-gradient);
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--secondary-gradient);
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .container {
          padding: 15px;
        }
        
        input {
          width: 100%;
          margin-bottom: 15px;
        }
        
        button {
          width: 100%;
        }
        
        #searchInput2 {
          width: 90%;
        }
        
        .json-viewer {
          margin: 20px 10px;
          padding: 20px;
        }
      }

      /* Pulse animation for loading */
      @keyframes pulse {
        0%, 100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      #loading {
        animation: pulse 1.5s ease-in-out infinite;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="search-box">
        <input
          type="text"
          id="searchInput1"
          placeholder="Search for stocks..."
        />
        <button onclick="searchStocks()">Search</button>
      </div>
      <div id="loading" style="display: none">Loading...</div>
      <div id="error" style="display: none"></div>
      <table class="stock-table" id="stockTable" style="display: none">
        <thead>
          <tr>
            <th>Company</th>
            <th>LTP</th>
            <th>Change</th>
            <th>Change %</th>
            <th>Volume</th>
            <th>Last Updated</th>
          </tr>
        </thead>
        <tbody id="stockBody"></tbody>
      </table>
    </div>
    <!-- Enhanced JSON Viewer Section -->
    <input type="text" id="searchInput2" placeholder="Search JSON data..." />
    <div id="jsonViewer" class="json-viewer"></div>

    <script>
      const jsonData = {
        "market": {
          "indices": {
            "NIFTY": {
              "value": 19674.25,
              "change": 125.30,
              "changePercent": 0.64
            },
            "SENSEX": {
              "value": 65995.63,
              "change": 418.20,
              "changePercent": 0.64
            }
          },
          "sectors": {
            "IT": ["TCS", "Infosys", "Wipro", "HCL Tech"],
            "Banking": ["HDFC Bank", "ICICI Bank", "SBI", "Axis Bank"],
            "Pharma": ["Sun Pharma", "Dr Reddy's", "Cipla", "Divi's Labs"]
          }
        },
        "trending": {
          "gainers": [
            {"name": "Adani Ports", "change": 8.5},
            {"name": "JSW Steel", "change": 6.2},
            {"name": "Tata Motors", "change": 5.8}
          ],
          "losers": [
            {"name": "Bajaj Finance", "change": -3.2},
            {"name": "Asian Paints", "change": -2.8},
            {"name": "Nestle", "change": -2.1}
          ]
        },
        "news": {
          "headlines": [
            "Market reaches new highs amid positive sentiment",
            "Tech stocks lead the rally",
            "Banking sector shows strong performance"
          ],
          "sources": [
            "https://economictimes.com",
            "https://moneycontrol.com",
            "https://livemint.com"
          ]
        }
      };

      // Recursively create the collapsible tree structure
      function createTree(data) {
        const treeContainer = document.createElement("ul");

        for (const key in data) {
          const value = data[key];
          const li = document.createElement("li");
          const isObject = typeof value === "object" && !Array.isArray(value);
          const isArray = Array.isArray(value);

          // Add collapsible behavior for nested objects/arrays
          if (isObject || isArray) {
            li.innerHTML = `<div class="toggle-container"><span class="toggle">${key}</span></div>`;
            const nestedTree = createTree(value);
            const nestedContainer = document.createElement("ul");
            nestedContainer.classList.add("nested");
            nestedContainer.appendChild(nestedTree);
            li.appendChild(nestedContainer);
          } else {
            // Display key-value pairs directly (no collapsibility for literals)
            const leafClass = "leaf-value";
            li.innerHTML = `<span class="key">${key}:</span> <span class="${leafClass}">${createLink(
              value
            )}</span>`;
          }

          treeContainer.appendChild(li);
        }

        return treeContainer;
      }

      // Function to create anchor tags for URLs
      function createLink(value) {
        if (typeof value === "string" && value.startsWith("http")) {
          return `<a href="${value}" target="_blank">${value}</a>`;
        }
        return value; // return the value as is if it's not a URL
      }

      // Toggle visibility of nested elements
      function toggleVisibility(event) {
        const toggleElement = event.target.closest(".toggle-container");
        if (toggleElement) {
          const nestedList = toggleElement.nextElementSibling;
          if (nestedList && nestedList.classList.contains("nested")) {
            nestedList.classList.toggle("open");
          }
        }
      }

      // Search functionality
      const searchInput = document.getElementById("searchInput2");
      searchInput.addEventListener("input", () => {
        const searchTerm = searchInput.value.toLowerCase();
        const filteredData = filterJSON(jsonData, searchTerm);
        renderJSON(filteredData, document.getElementById("jsonViewer"));
      });

      function filterJSON(data, searchTerm) {
        const filteredData = {};

        // Loop through data and filter based on searchTerm
        for (const key in data) {
          const value = data[key];
          if (typeof value === "object" && !Array.isArray(value)) {
            const filteredNested = filterJSON(value, searchTerm);
            if (Object.keys(filteredNested).length > 0) {
              filteredData[key] = filteredNested;
            }
          } else if (Array.isArray(value)) {
            const filteredArray = value.filter((item) => {
              return JSON.stringify(item).toLowerCase().includes(searchTerm);
            });
            if (filteredArray.length > 0) {
              filteredData[key] = filteredArray;
            }
          } else if (
            typeof value === "string" &&
            value.toLowerCase().includes(searchTerm)
          ) {
            filteredData[key] = value;
          }
        }

        return filteredData;
      }

      // Render the filtered JSON data
      function renderJSON(jsonData, container) {
        const tree = createTree(jsonData);
        container.innerHTML = ""; // Clear previous content
        container.appendChild(tree);
      }

      // Initial rendering
      document
        .getElementById("jsonViewer")
        .addEventListener("click", toggleVisibility);
      renderJSON(jsonData, document.getElementById("jsonViewer"));

      //BL Get API
      const searchInput1 = document.getElementById("searchInput1");
      const stockTable = document.getElementById("stockTable");
      const stockBody = document.getElementById("stockBody");
      const loading = document.getElementById("loading");
      const error = document.getElementById("error");

      searchInput1.addEventListener("keypress", (e) => {
        if (e.key === "Enter") searchStocks();
      });

      async function searchStocks() {
        const query = searchInput1.value.trim();
        if (!query) return;

        loading.style.display = "block";
        error.style.display = "none";
        stockTable.style.display = "none";

        try {
          const response = await fetch(
            `https://blstocks.thehindubusinessline.com/companiesinfo/search?query=${query}`
          );
          const data = await response.json();
          displayStocks(data.companiesDetails || []);
        } catch (err) {
          error.style.display = "block";
          error.textContent = "Failed to fetch stock data";
        } finally {
          loading.style.display = "none";
        }
      }

      function displayStocks(stocks) {
        if (!stocks.length) {
          error.style.display = "block";
          error.textContent = "No stocks found";
          return;
        }

        stockBody.innerHTML = stocks
          .map(
            (stock) => `
        <tr>
            <td><a href="${stock.url}" target="_blank">${stock.title}</a></td>
            <td>₹${stock.LTP?.toFixed(2) || "N/A"}</td>
            <td class="${
              stock.CHANGE ? (stock.CHANGE >= 0 ? "positive" : "negative") : ""
            }">
                ${
                  stock.CHANGE
                    ? (stock.CHANGE >= 0 ? "+" : "") + stock.CHANGE.toFixed(2)
                    : "N/A"
                }
            </td>
            <td class="${
              stock.change_PERC
                ? stock.change_PERC >= 0
                  ? "positive"
                  : "negative"
                : ""
            }">
                ${
                  stock.change_PERC
                    ? (stock.change_PERC >= 0 ? "+" : "") +
                      stock.change_PERC.toFixed(2) +
                      "%"
                    : "N/A"
                }
            </td>
            <td>${stock.VOLUME?.toLocaleString() || "N/A"}</td>
            <td class="time">${
              stock.Upd_Time
                ? new Date(stock.Upd_Time).toLocaleTimeString()
                : "N/A"
            }</td>
        </tr>
    `
          )
          .join("");

        stockTable.style.display = "table";
      }
    </script>
  </body>
</html>